<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>新闻列表</title>
		<link rel="stylesheet" type="text/css" href="css/weuix.min.css" />
		<link rel="stylesheet" type="text/css" href="css/weui3.css" />
	</head>

	<body>
		<div>
			<div class="weui_cells" style="padding:10px 15px;background:#ebecee">
				<p class="left">新闻中心</p>
			</div>
			<div class="router-view news">
				<div class="weui_panels">
					<div style="margin:0 15px 10px;box-shadow: 0px 0px 3px 3px gainsboro;">
						<a href="details_new.html">
							<div class="" style="border-radius: 2px;">
								<div class="m-img" style="background-image: url(&quot;https://cdn.xiaotaojiang.com/uploads/82/1572ec37969ee263735262dc017975/_.jpg&quot;);"></div>
								<div class="f-black " style="padding:5px 10px;background: #FFFFFF;">
									洗颜新潮流！sad撒的撒打算的
									<br> <span class="m-time iconfont icon-iconfontshijian f13 f-gray"></span><span class="f13 f-gray" style="margin-left:5px">2016-03-18</span>
								</div>
							</div>
						</a>
					</div>
					<div style="margin:0 15px 10px;box-shadow: 0px 0px 3px 3px gainsboro;">
						<a href="details_new.html">
							<div class="" style="border-radius: 2px;">
								<div class="m-img" style="background-image: url(&quot;https://cdn.xiaotaojiang.com/uploads/82/1572ec37969ee263735262dc017975/_.jpg&quot;);"></div>
								<div class="f-black " style="padding:5px 10px;background: #FFFFFF;">
									洗颜新潮流！人气洁面皂排行榜
									<br> <span class="m-time iconfont icon-iconfontshijian f13 f-gray"></span><span class="f13 f-gray" style="margin-left:5px">2016-03-18</span>
								</div>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="js/zepto.min.js"></script>
	<script src="js/updown.js"></script>
	<script src="js/lazyimg.js"></script>
		<script>
			$(function() {
				//页数 
				var page = 0;
				// 每页展示6个
				var size = 6;
				$('.news').dropload({
					scrollArea: window,
					autoLoad: true, //自动加载
					domDown: { //上拉
						domClass: 'dropload-down',
						domRefresh: '<div class="dropload-refresh f15 "><i class="iconfont icon-jiantouxiangshang" style="font-size:1.1em"></i>上拉加载更多</div>',
						domLoad: '<div class="dropload-load f15"><span class="weui-loading"></span>正在加载中...</div>',
						domNoData: '<div class="dropload-noData">没有更多数据了</div>'
					},
					domUp: { //下拉
						domClass: 'dropload-up',
						domRefresh: '<div class="dropload-refresh"><i class="icon icon-114"></i>上拉加载更多</div>',
						domUpdate: '<div class="dropload-load f15"><i class="icon icon-20"></i>释放更新...</div>',
						domLoad: '<div class="dropload-load f15"><span class="weui-loading"></span>正在加载中...</div>'
					},
					loadUpFn: function(me) { //刷新
						$.ajax({
							type: 'GET',
							url: 'json.json',

							dataType: 'json',
							success: function(data) {
								var result = '';
								for(var i = 0; i < data.length; i++) {
									result += '<div style="margin:0 15px 10px;box-shadow: 0px 0px 3px 3px gainsboro;">' +
											'<a href="details_new.html">' +
											'<div class="" style="border-radius: 2px;">' +
											'<div class="m-img" style="background-image: url(&quot;https://cdn.xiaotaojiang.com/uploads/82/1572ec37969ee263735262dc017975/_.jpg&quot;);"></div>' +
											'<div class="f-black " style="padding:5px 10px;background: #FFFFFF;">' +
											data[i].title +
											'<br> <span class="m-time iconfont icon-iconfontshijian f13 f-gray"></span><span class="f13 f-gray" style="margin-left:5px">' + data[i].date + '</span>' +
											'</div>' +
											'</div>' +
											'</a>' +
											'</div>';
								}
								// 为了测试，延迟1秒加载
								setTimeout(function() {
									$('.weui_panels').html(result);
									var lazyloadImg = new LazyloadImg({
										el: '.weui-updown [data-img]', //匹配元素
										top: 10, //元素在顶部伸出长度触发加载机制
										right: 50, //元素在右边伸出长度触发加载机制
										bottom: 10, //元素在底部伸出长度触发加载机制
										left: 50, //元素在左边伸出长度触发加载机制
										qriginal: false, // true，自动将图片剪切成默认图片的宽高；false显示图片真实宽高
										load: function(el) {
											el.style.cssText += '-webkit-animation: fadeIn 01s ease 0.2s 1 both;animation: fadeIn 1s ease 0.2s 1 both;';
										},
										error: function(el) {

										}
									});
									// 每次数据加载完，必须重置
									me.resetload();
									// 重置索引值，重新拼接more.json数据
									page = 0;
									// 解锁
									me.unlock();
									me.noData(false);
								}, 1000);
							},
							error: function(xhr, type) {
								alert('Ajax error!');
								// 即使加载出错，也得重置
								me.resetload();
							}
						});
					},
					loadDownFn: function(me) { //加载更多
						page++;
						window.history.pushState(null, document.title, window.location.href);
						var result = '';
						$.ajax({
							type: 'GET',
							url: 'http://ons.me/tools/dropload/json.php?page=' + page + '&size=' + size,
							dataType: 'json',
							success: function(data) {
								var arrLen = data.length;
								if(arrLen > 0) {

									for(var i = 0; i < arrLen; i++) {
										result += '<div style="margin:0 15px 10px;box-shadow: 0px 0px 3px 3px gainsboro;">' +
											'<a href="details_new.html">' +
											'<div class="" style="border-radius: 2px;">' +
											'<div class="m-img" style="background-image: url(&quot;https://cdn.xiaotaojiang.com/uploads/82/1572ec37969ee263735262dc017975/_.jpg&quot;);"></div>' +
											'<div class="f-black " style="padding:5px 10px;background: #FFFFFF;">' +
											data[i].title +
											'<br> <span class="m-time iconfont icon-iconfontshijian f13 f-gray"></span><span class="f13 f-gray" style="margin-left:5px">' + data[i].date + '</span>' +
											'</div>' +
											'</div>' +
											'</a>' +
											'</div>';
									}
									// 如果没有数据
								} else {
									// 锁定
									me.lock();
									// 无数据
									me.noData();
								}
								// 为了测试，延迟1秒加载
								setTimeout(function() {
									$('.weui_panels').append(result);
									var lazyloadImg = new LazyloadImg({
										el: '.weui-updown [data-img]', //匹配元素
										top: 10, //元素在顶部伸出长度触发加载机制
										right: 50, //元素在右边伸出长度触发加载机制
										bottom: 10, //元素在底部伸出长度触发加载机制
										left: 50, //元素在左边伸出长度触发加载机制
										qriginal: false, // true，自动将图片剪切成默认图片的宽高；false显示图片真实宽高
										load: function(el) {
											el.style.cssText += '-webkit-animation: fadeIn 01s ease 0.2s 1 both;animation: fadeIn 1s ease 0.2s 1 both;';
										},
										error: function(el) {

										}
									});
									// 
									// 每次数据加载完，必须重置
									me.resetload();
								}, 1000);
							},
							error: function(xhr, type) {
								alert('Ajax error!');
								// 即使加载出错，也得重置
								me.resetload();
							}
						});
					}
				});
			});
		</script>
</html>